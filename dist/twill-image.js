!function(){"use strict";let e;const t=new WeakMap,s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;function i(i){const a=s&&s.effectiveType;return"IntersectionObserver"in window?(e||(e=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const s=t.get(e.target);s&&s(),t.delete(e.target)}}))}),{rootMargin:"4g"!==a||s&&s.saveData?"2500px":"1250px"})),function(s){return s&&(t.set(s,i),e.observe(s)),function(){e&&s&&(t.delete(s),e.unobserve(s))}}):function(){return i(),function(){}}}const a=new Set;class r{_unobserve(){}constructor(e){this.el=e,this.main=e.querySelector("[data-twill-image-main]"),this.placeholder=e.querySelector("[data-twill-image-placeholder]"),this.isLoading="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype,this.isLoaded=!1,this.load=this.load.bind(this),this.reveal=this.reveal.bind(this),this.cacheKey=JSON.stringify(this.main.src||this.main.dataset.src),this.revealed=!1,this.main.dispatchEvent(new CustomEvent("twill-image:start")),this.main.onload=e=>{this.load(e.currentTarget),this.main.dispatchEvent(new CustomEvent("twill-image:loaded"))},this.isLoading&&this.reveal(),(this.isLoading||this.main.complete)&&this.load(this.main)}set isLoaded(e){this._isLoaded=e,e?(this.main.style.transition="opacity 500ms linear",this.main.style.opacity=1):(this.main.style.transition="",this.main.style.opacity=0),e&&this.unobserve()}get isLoaded(){return this._isLoaded}set unobserve(e){this._unobserve=e}get unobserve(){return this._unobserve}get isCached(){return e=this.cacheKey,a.has(e);var e}reveal(){const e=this.main.parentElement.querySelectorAll("source");e&&e.forEach((e=>{e.dataset.src&&(e.setAttribute("src",e.dataset.src),delete e.dataset.src),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),delete e.dataset.srcset)})),this.main.dataset.src&&(this.main.setAttribute("src",this.main.dataset.src),delete this.main.dataset.src),this.main.dataset.srcset&&(this.main.setAttribute("srcset",this.main.dataset.srcset),delete this.main.dataset.srcset),this.revealed=!0,this.main.dispatchEvent(new CustomEvent("twill-image:revealed"))}load(e){if(this.isLoaded)return;var t;(t=this.cacheKey)&&a.add(t);const s=new Image;s.src=e.currentSrc,s.decode?s.decode().catch((()=>{})).then((()=>{this.isLoaded=!0})):this.isLoaded=!0}}class n{constructor(){this.reset=function(e,t,s){let i;return function(){const a=this,r=arguments,n=function(){i=null,s||e.apply(a,r)},o=s&&!i;clearTimeout(i),i=setTimeout(n,t),o&&e.apply(a,r)}}(this._reset,100).bind(this),this.start()}get images(){return document.querySelectorAll("[data-twill-image-wrapper]")}start(){this.images.forEach((e=>{e.wrapper||(e.wrapper=new r(e));const t=i((()=>{!e.wrapper.revealed&&e.wrapper.reveal(),e.wrapper.isCached&&(e.wrapper.isLoaded=!0)}));e.wrapper.unobserve=t(e)}))}_reset(){this.images.forEach((e=>{e.wrapper&&e.wrapper.unobserve&&e.wrapper.unobserve(),e.wrapper&&e.wrapper.unobserve&&(e.wrapper.unobserve=()=>{}),this.start()}))}}document.addEventListener("DOMContentLoaded",(function(){window.TwillImage=new n}))}();
