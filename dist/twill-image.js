!function(){"use strict";let e;const t=new WeakMap,s=navigator.connection||navigator.mozConnection||navigator.webkitConnection;function a(a){const i=s&&s.effectiveType;return"IntersectionObserver"in window?(e||(e=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const s=t.get(e.target);s&&s(),t.delete(e.target)}}))}),{rootMargin:"4g"!==i||s&&s.saveData?"2500px":"1250px"})),function(s){return s&&(t.set(s,a),e.observe(s)),function(){e&&s&&(t.delete(s),e.unobserve(s))}}):function(){return a(),function(){}}}const i=new Set;class r{_unobserve(){}constructor(e){this.el=e,this.main=e.querySelector("[data-main-image]"),this.placeholder=e.querySelector("[data-placeholder-image]"),this.isLoading="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype,this.isLoaded=!1,this.onload=this.onload.bind(this),this.reveal=this.reveal.bind(this),this.cacheKey=JSON.stringify(this.main.src||this.main.dataset.src),this.main.onload=this.onload,this.isLoading&&this.reveal()}set isLoaded(e){this._isLoaded=e,this.main.style.opacity=e?1:0,e&&this.unobserve()}get isLoaded(){return this._isLoaded}set unobserve(e){this._unobserve=e}get unobserve(){return this._unobserve}get isCached(){return e=this.cacheKey,i.has(e);var e}reveal(){const e=this.main.parentElement.querySelectorAll("source");e&&e.forEach((e=>{e.dataset.src&&(e.setAttribute("src",e.dataset.src),delete e.dataset.src),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),delete e.dataset.srcset)})),this.main.dataset.src&&(this.main.setAttribute("src",this.main.dataset.src),delete this.main.dataset.src),this.main.dataset.srcset&&(this.main.setAttribute("srcset",this.main.dataset.srcset),delete this.main.dataset.srcset),this.main.complete&&(this.isLoaded=!0)}onload(e){if(this.isLoaded)return;var t;(t=this.cacheKey)&&i.add(t);const s=e.currentTarget,a=new Image;a.src=s.currentSrc,a.decode?a.decode().catch((()=>{})).then((()=>{this.isLoaded=!0})):this.isLoaded=!0}}class n{constructor(){this.reset=function(e,t,s){let a;return function(){const i=this,r=arguments,n=function(){a=null,s||e.apply(i,r)},o=s&&!a;clearTimeout(a),a=setTimeout(n,t),o&&e.apply(i,r)}}(this._reset,100).bind(this),this.start()}get images(){return document.querySelectorAll("[data-twill-image-wrapper]")}start(){this.images.forEach((e=>{e.wrapper||(e.wrapper=new r(e));const t=a((()=>{e.wrapper.reveal(),e.wrapper.isCached&&(e.wrapper.isLoaded=!0)}));e.wrapper.unobserve=t(e)}))}_reset(){this.images.forEach((e=>{e.wrapper&&e.wrapper.unobserve&&e.wrapper.unobserve(),e.wrapper.unobserve=()=>{},this.start()}))}}document.addEventListener("DOMContentLoaded",(function(){window.TwillImage=new n}))}();
